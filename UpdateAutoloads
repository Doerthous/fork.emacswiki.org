Your [[.emacs]] file is full of `require's, your private elisp directory is packed with interesting libraries; now starting up emacs takes ages. One way to speed it up is to write autoloads for every probable entry point of every library so that the library gets loaded just when the function is called. You could do this by hand, but emacs has a mechanism to deal with this problem, magic autoload comments. Read more about them in [[Manual:autoload cookie]].

Emacs' mechanism for creating autoload forms from autoload magic comments is unfortunately mostly targeted at building emacs. But we can trick it so it also works in our personal lisp directory. First, create a `lisp' subdirectory in there. Then set the variable `my-lisp-dir' to the path to your personal lisp directory (with a trailing slash). Evaluate and execute this function:

    (defun my-update-autoloads ()
      "Call `update-autoloads-from-directories' on my local lisp directory."
      (interactive)
      (require 'autoload)
      (let ((source-directory my-lisp-dir))
        (update-autoloads-from-directories my-lisp-dir))
      (byte-compile-file (concat my-lisp-dir "lisp/loaddefs.el")))

And if all goes well, add 

    (load (concat my-lisp-dir "lisp/loaddefs") t)

to your .emacs. Voila! Of course you have to `M-x my-update-autoloads' every time you add a new library. Oh, and be prepared to find buggy magic autoload comments. 

[new:pkal:2021-01-02 14:52 UTC]

This didn't seem to work on my system, but after playing around for a bit, it appears that the following works well

    ;;; load local lisp files
    (defun local/prepare-local-lisp (dir)
      "Prepare (compile + autoload) all packages in directory DIR."
      (require 'autoload)
      (let ((generated-autoload-file (expand-file-name "al.el" dir)))
	(dolist (dir (directory-files dir t "^[^.]"))
	  (when (file-directory-p dir)
	    (byte-recompile-directory dir 0)
	    (update-directory-autoloads dir)))
	(add-to-list 'load-path dir)
	(load generated-autoload-file nil t)))

    (local/prepare-local-lisp (locate-user-emacs-file "lisp"))

It checks every directory in <tt>~/.emacs/lisp</tt> and updates the autoload data/compiles it if necessary.
